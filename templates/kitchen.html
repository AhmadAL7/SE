<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Kitchen Orders</title>

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</head>
<body>
    <nav>
        <div class="nav-container">
            <div class="burger" id="burger">
                <div></div>
                <div></div>
                <div></div>
            </div>
            <div class="nav-links" id="navLinks">
                <a href="{{ url_for('reservations.reservations_creation') }}">Create Reservation</a>
                <a href="{{ url_for('support.support_page') }}">Customer Support</a>
                <a href="{{ url_for('menu.menu') }}">Menu</a>
    
                {% if not session.get('username') %}
                    <a href="{{ url_for('auth.sign_in') }}">Sign in</a>
                {% else %}
                    <a href="{{ url_for('reservations.reservations_foh') }}">View Reservations (FOH)</a>
                    <a href="{{ url_for('notifications.notifications') }}">Notifications</a>
                    <a href="{{ url_for('manager.requests_manager') }}">Manager Requests</a>
                    <a href="{{ url_for('menu.add_menu_item') }}">Add Menu Items</a>
                    <a href="{{ url_for('support.view_queries') }}">Manager: View Queries</a>
                    <a href="{{ url_for('inventory.add_supplier_inventory') }}">Supplier/Inventory</a>
                    <a href="{{ url_for('manager.get_my_schedule') }}">Schedule</a>
                    <a href="{{ url_for('manager.view_staff_schedules') }}">Manage Schedules</a>
                    <a href="{{ url_for('payment.payment_tables') }}">Table Payments</a>
                    <a href="{{ url_for('manager.create_schedule') }}">Create Schedule</a>
                    <a href="{{ url_for('manager.manager_reports') }}">Reports</a>
                    <a href="{{ url_for('order.view_tables') }}">Tables</a>
                    <a href="{{ url_for('inventory.inventory') }}">Inventory</a>
                    <a href="{{ url_for('auth.get_profile') }}">Profile</a>
                    <a href="{{ url_for('auth.logout') }}">Logout</a>
                {% endif %}
            </div>
        </div>
    </nav>
    <section>
            <div class="container">
                <h2>Kitchen Orders</h2>
                <p v-if="orders.length === 0">No orders currently in progress.</p>
                 <!--to avoid jinja conflict with vue syntax-->
                {% raw %} 
                <div v-for="order in orders" :key="order.id" class="order-card">
                    <p><strong>Order ID:</strong> {{ order.id }}</p>
                    <p><strong>Table:</strong> {{ order.table_id }}</p>
                    <p><strong>Total:</strong> ${{ order.total_price.toFixed(2) }}</p>
                    <ul>
                        <li v-for="item in order.items">{{ item.description }} x{{ item.quantity }}</li>
                    </ul>
                    <form :action="'/mark_done/' + order.id" method="POST">
                        <button type="submit" class="done-button">Mark as Done</button>
                    </form>
                </div>
                {% endraw %}
            </div>
        </div>
    </section>
    
    <footer>
        <p>All rights reserved.</p>
    </footer>

</body>
<script>
    const { createApp } = Vue; // get the createApp function from the Vue
    
    createApp({
        data() {
            return {
                orders: []
            }
        },
        methods: {
            fetchOrders() {
                fetch('/kitchen/orders/json')
                    .then(res => res.json())
                    .then(data => {
                        this.orders = data;
                    })
                    .catch(err => console.error("Fetch error:", err));
            }
        },
        mounted() {// runs once when the page finishes loading
            this.fetchOrders(); // initial order patch
            setInterval(this.fetchOrders, 2000); // update the orders 
        }
    }).mount('#app');


    </script>
    
</html>
